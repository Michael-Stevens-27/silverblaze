<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model Choice and Validation • silverblaze</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model Choice and Validation">
<meta property="og:description" content="silverblaze">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">silverblaze</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Basic tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/Poisson-basic-implementation.html">Poisson model and count data</a>
    </li>
    <li>
      <a href="../articles/Binomial-basic-implementation.html">Binomial model and prevalence data</a>
    </li>
    <li>
      <a href="../articles/PointPattern-basic-implementation.html">Point pattern data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model-validation.html">Model Validation</a>
    </li>
    <li>
      <a href="../articles/MHCoupling.html">Metropolis-Hastings Coupling</a>
    </li>
    <li>
      <a href="../articles/complex-spatial-priors.html">Complex Spatial Priors</a>
    </li>
    <li>
      <a href="../articles/Variable-sigma.html">Variable Sigma</a>
    </li>
    <li>
      <a href="../articles/Variable-population.html">Variable Expected Population</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Michael-Stevens-27/silverblaze">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><link href="model-validation_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="model-validation_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model Choice and Validation</h1>
                        <h4 class="author">Michael Stevens</h4>
            
            <h4 class="date">2021-02-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Michael-Stevens-27/silverblaze/blob/master/vignettes/model-validation.Rmd"><code>vignettes/model-validation.Rmd</code></a></small>
      <div class="hidden name"><code>model-validation.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>If you have followed any of the basic tutorials for Silverblaze you would have already seen a few ways to validate the model that has been used. In this tutorial we will walk through an extensive list of ways that ensure the model is behaving as it should be. We are responsible for simulating the data in the basic tutorials, so a good way to know if the model is successful is if it returns the correct parameter values that were used to generate the data. Of course, this will not be the case in a real-world data set. So here we will be focussing on methods of model validity that are independent of parameter estimation. In addition to this, we shall also briefly discuss model choice. Silverblaze offers a finite mixture model for geographic profiling and we require a method for choosing the number of mixture components that best describe the data.</p>
<p>This tutorial will cover model validty:</p>
<ul>
<li>A healthy MCMC trace</li>
<li>Geweke's metric for single chain MCMC convergence</li>
<li>Auto-correlation</li>
<li>Effective sample sizes</li>
<li>Acceptance rates for proposed Metropolis-Hastings steps</li>
</ul>
<p>and model choice:</p>
<ul>
<li>Deviance information criterion</li>
</ul>
</div>
<div id="model-validity" class="section level2">
<h2 class="hasAnchor">
<a href="#model-validity" class="anchor"></a>Model validity</h2>
<p>To check the validity of the model we shall be considering the datagenerated in <a href="https://michael-stevens-27.github.io/silverblaze/articles/Poisson-basic-implementation.html">tutorial 1</a>. Let's start by looking at the trace of the log-likelihood.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_trace.html">plot_trace</a></span><span class="op">(</span><span class="va">p</span>, K <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="model-validation_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The trace resembles the form of a "hairy caterpillar," in that the log-likelihood appears to have converged around a particular value. Whether or not an MCMC chain has converged is decided via Geweke's convergence metric (<span class="citation">Cowles and Carlin (1996)</span>). Essentially this metric will take the first <span class="math inline">\(a\)</span> iterations in an MCMC chain and compare them with the last <span class="math inline">\(b\)</span> iterations in a similar manner to a two sample t-test. In addition to the MCMC trace we can also visualise the auto-correlation in our log-likelihood.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_acf.html">plot_acf</a></span><span class="op">(</span><span class="va">p</span>, K <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="model-validation_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>This plot is promising, the MCMC chain ran for 50,000 sampling iterations and the auto-correlation reduces to zero after a lag of about 40 iterations. Finally, we can plot the density of the log-likelihood too.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_density.html">plot_density</a></span><span class="op">(</span><span class="va">p</span>, K <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="model-validation_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The density it unimodal, if we were to see a bi-modal density plot, this would indicate the MCMC chain is getting stuck somewhere in the parameter space, so a longer burnin may be needed. Conveniently we can plot all three of the above using the <code><a href="../reference/plot_loglike_diagnostic.html">plot_loglike_diagnostic()</a></code> function.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_loglike_diagnostic.html">plot_loglike_diagnostic</a></span><span class="op">(</span><span class="va">p</span>, K <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="model-validation_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Although we ran our MCMC chain for 50,000 iterations, this doesn't necessarily mean we have 50,000 independent draws from our posterior distribution. We measure the true number of independent samples using the , ESS. This is a function of the number of sampling iterations <span class="math inline">\(n\)</span>, with a penalty dependent on the auto-correlation in samples. The expression for the ESS is <span class="math display">\[ESS = \frac{n}{1 + 2\sum_{l = 1}^{\infty}acf(l)}.\]</span> Where <span class="math inline">\(acf(l)\)</span> is the auto-correlation at lag <span class="math inline">\(l\)</span>.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ESS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_output.html">get_output</a></span><span class="op">(</span><span class="va">p</span>, name <span class="op">=</span> <span class="st">"ESS"</span>, K <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"summary"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "ESS = 3187.8 or 0.0638 independent samples per iteration (50,000 sampling iterations)"</code></pre>
<p>So we've approximately four thousand independent posterior samples, this is useful if we know a certain number we need to obtain, but this can also be expressed as the number of independent samples per iteration. Here it's 0.06.</p>
<p>Another indicator of a healthy MCMC algorithm is the acceptance rates of proposed steps during the Metropolis-Hastings part of the process. In this case, source locations and sigma values are estimated using a Metropolis-Hastings step. We are aiming for an acceptance rate of 23% for sources and 44% for sigma (see <span class="citation">Garthwaite, Fan, and Sisson (2016)</span> for more information).</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">acceptance_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_output.html">get_output</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"source_accept_sampling"</span>, K <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"summary"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">acceptance_source</span><span class="op">)</span></code></pre></div>
<pre><code>##        group1  group2
## rung1 0.22052 0.13216</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">acceptance_sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_output.html">get_output</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"sigma_accept_sampling"</span>, K <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"summary"</span><span class="op">)</span>
<span class="va">acceptance_sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">acceptance_sigma</span><span class="op">)</span>
<span class="va">acceptance_sigma</span> <span class="op">&lt;-</span> <span class="va">acceptance_sigma</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">acceptance_sigma</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">acceptance_sigma</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.47562</code></pre>
<p>These values aren't awful, but there is clearly room for improvement, especially in the third source and sigma.</p>
</div>
<div id="model-choice" class="section level2">
<h2 class="hasAnchor">
<a href="#model-choice" class="anchor"></a>Model choice</h2>
<p>As we have seen above, there are many ways of checking the ability of the model but we've done very little to compare the difference between models. Given we adopt a finite mixture model, we must decide on which value of <code>K</code> best describes the data. <span class="citation">Spiegelhalter et al. (2014)</span> offers a metric for model comparison when estimating parameters via MCMC methods. The deviance information criterion (DIC) is calculated in two steps. Firstly we calculate the model deviance, which is the mean of the log-likelihood multiplied by -2. We then add to this a penalty term for the complexity of the model. The complexity is calculated as the variance in the log-likelihood multiplied by 4.</p>
<p>This DIC can be visualised using the <code><a href="../reference/plot_DIC_gelman.html">plot_DIC_gelman()</a></code> function. Let's have a look at the DIC values for each model.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_DIC_gelman.html">plot_DIC_gelman</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code></pre></div>
<p><img src="model-validation_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>As we can see the model with the lowest DIC is the one fitting 2 sources. This is exactly what we would expect given we simulated under a model where <code>K = 2</code>.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Cowles1996">
<p>Cowles, Mary Kathryn, and Bradley P Carlin. 1996. “Markov Chain Monte Carlo Convergence Diagnostics: A Comparative Review.” <em>Journal of the American Statistical Association</em> 91 (434): 883–904.</p>
</div>
<div id="ref-Garthwaite2016">
<p>Garthwaite, P. H., Y. Fan, and S. A. Sisson. 2016. “Adaptive optimal scaling of Metropolis–Hastings algorithms using the Robbins–Monro process.” <em>Communications in Statistics - Theory and Methods</em> 45 (17). Taylor &amp; Francis: 5098–5111.</p>
</div>
<div id="ref-Spiegelhalter2014">
<p>Spiegelhalter, D J, N G Best, B P Carlin, and A Van Der Linde. 2014. “The deviance information criterion: 12 years on.” <em>Journal of the Royal Statistical Society: Series B</em> 76 (3): 485–93.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bob Verity, Michael Stevens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
